# 🔐 Google 認証制限ガイド

このアプリケーションは、特定のGoogleアカウント（メールアドレス）でのみログインを許可する機能を備えています。

---

## 📋 概要

- **目的**: 個人用アプリケーションの場合、特定のメールアドレスのGoogleアカウントでのみアクセスを許可
- **制限方式**: Google ログイン時にメールアドレスをチェック
- **他のアカウントでログイン**: 自動的にサインアウトし、エラーメッセージを表示

---

## ⚙️ セットアップ

### ローカル開発環境

#### 1. 設定ファイルを作成

```bash
cp js/config.example.js js/config.js
```

#### 2. メールアドレスを設定

`js/config.js` を開いて編集：

```javascript
export const CONFIG = {
  ALLOWED_GOOGLE_EMAIL: 'your-email@gmail.com',  // ← あなたのメールアドレスに変更
};
```

### Vercel（本番環境）

#### 1. 環境変数を設定

Vercelダッシュボードで以下を追加：

```
変数名:  VITE_ALLOWED_GOOGLE_EMAIL
値:     ito.atsu.mail@gmail.com（または許可するメールアドレス）
```

**設定手順:**
1. Vercel ダッシュボードを開く
2. プロジェクトを選択
3. **Settings** をクリック
4. 左メニューの **Environment Variables** を選択
5. **Add New** をクリック
6. 上記の変数名と値を入力
7. **Save** をクリック

#### 2. デプロイ

```bash
git push origin main
```

環境変数は自動的に Vercel で適用されます。

---

## 🔍 動作確認

### ローカル環境での確認

1. `http://localhost:8000/` にアクセス
2. **Sign in with Google** をクリック
3. 許可されたメールアドレスでログイン → ✅ ログイン成功
4. 別のメールアドレスでログイン → ❌ エラーメッセージ表示

### Vercel環境での確認

1. Vercelのデプロイ URL にアクセス
2. 同様にテスト
3. ブラウザのコンソールで確認

---

## 🐛 トラブルシューティング

### 「このGoogleアカウントではログインできません」エラーが表示される

**原因**: ログインしたメールアドレスが許可リストに含まれていない

**解決方法**:
1. 設定ファイル（ローカル）または環境変数（Vercel）を確認
2. メールアドレスのスペル、大文字小文字を確認
3. Gmail のプライマリメールアドレスを使用しているか確認

### ローカル環境では動作するが、Vercel では動作しない

**原因**: Vercel の環境変数が設定されていない

**解決方法**:
1. Vercel ダッシュボードで環境変数が正しく設定されているか確認
2. デプロイ後、十分に時間が経過したか確認（最大数分かかる場合あり）
3. キャッシュをクリアして再度テスト

```bash
# Vercel での再デプロイ
git push origin main  # または Vercel UI から再デプロイ
```

---

## 📝 環境変数の優先順位

アプリケーションは以下の優先順位で環境変数を読み込みます：

1. **Vercel 環境変数** (`VITE_ALLOWED_GOOGLE_EMAIL`)
2. **グローバル環境変数** (`window.__ALLOWED_GOOGLE_EMAIL`)
3. **ローカル設定ファイル** (`js/config.js`)

---

## 🔒 セキュリティに関する注意

### ⚠️ コミット履歴

以前のコミット（`e3b8d51`）にはメールアドレスが含まれています。

**推奨対応**:
- リポジトリをプライベートに設定
- または過去のコミット履歴から削除（上級者向け）

```bash
# GitHub で設定を変更
Settings → Visibility → Private に変更
```

### ✅ 現在の実装

- `js/config.js` は `.gitignore` に登録
- メールアドレスは Git に追跡されない
- 個人情報は安全に管理できます

---

## 📚 関連ドキュメント

- [セットアップガイド](./SETUP.md) - 初期セットアップ手順
- [Firebase セットアップ](./FIREBASE_SETUP.md) - Firebase の設定方法

---

**最終更新**: 2025-11-30
**作成者**: Claude Code
